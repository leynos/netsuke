netsuke_version: "1.0"

vars:
  style: "{{ env('DT_STYLE') | default('natural') }}"
  outdir: "build/jpg/{{ style }}"

rules:
  - name: develop
    command: "mkdir -p $(dirname {outs}) && darktable-cli {ins} {outs} --style {{ style }}"
    description: Develop RAW image

  - name: thumb
    command: "mkdir -p $(dirname {outs}) && convert {ins} -resize 200x200^ -gravity center -extent 200x200 {outs}"
    description: Create thumbnail

targets:
{% for raw in glob('photos/*.nef') %}
  - name: "{{ outdir }}/{{ raw | basename | replace('.nef', '.jpg') }}"
    rule: develop
    sources: "{{ raw }}"
  - name: "{{ outdir }}/thumbs/{{ raw | basename | replace('.nef', '.jpg') }}"
    rule: thumb
    sources: "{{ outdir }}/{{ raw | basename | replace('.nef', '.jpg') }}"
{% endfor %}

defaults:
{% for raw in glob('photos/*.nef') %}
  - "{{ outdir }}/thumbs/{{ raw | basename | replace('.nef', '.jpg') }}"
{% endfor %}
