netsuke_version: "1.0"

vars:
  python: python3
  venv: .venv

rules:
  - name: setup
    command: "{{ python }} -m venv {{ venv }}"
    description: Create virtual environment
  - name: install
    command: "{{ venv }}/bin/pip install -e . -r requirements.txt"
    description: Install package
  - name: test
    command: "{{ venv }}/bin/python -m pytest {{ ins | join(' ') }}"
    description: Run tests

targets:
  - name: venv
    rule: setup
  - name: deps
    rule: install
    sources: requirements.txt
    deps:
      - venv
  - name: test-results
    rule: test
    sources: tests
    deps:
      - deps

defaults:
  - test-results
