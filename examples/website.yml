netsuke_version: "1.0"

vars:
  pages_dir: pages
  site_dir: site

macros:
  - signature: "page(path)"
    body: |
      - name: "{{ site_dir }}/{{ path | basename | replace('.md', '.html') }}"
        rule: page
        sources: "{{ path }}"

rules:
  - name: page
    command: "pandoc {ins} -o {outs}"

  - name: index
    script: |
      cat {{ site_dir }}/*.html > {{ site_dir }}/index.html

targets:
  - foreach: "{{ glob(pages_dir ~ '/*.md') }}"
    {{ page(item) }}

  - name: "{{ site_dir }}/index.html"
    rule: index
    deps: "{{ glob(site_dir ~ '/*.html') }}"
    always: true

defaults:
  - "{{ site_dir }}/index.html"
